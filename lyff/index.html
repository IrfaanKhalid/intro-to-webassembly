<!DOCTYPE html>
<html>
  <head>
    <!-- Our JavaScript goes inside of the script tag -->
    <script>
      // TODO 1 - Build our WebAssembly loader!
      async function createWebAssembly(path, importObject) {}

      // TODO 2 - Provide memory - replace null on line 10!
      const memory = null;
      let exports = null;

      async function init() {
        // TODO 3 - Define our environment and importObject
        const env = null;
        const importObject = { env };

        // TODO 4 - Pass importObject to the createWebAssembly method and use the output
        const wa = null;

        // TODO 5 - Add interactions with the LYFF board (i.e., draw it!)

        // TODO 6 - Define the behavior of a click handler
        canvas.onclick = (ev) => {};
      }

      // Function which allows us to access our board via a pointer
      function getBoardBuffer() {
        return new Uint8Array(memory.buffer, exports._board_ref());
      }

      // Function which draws our board
      function draw() {
        const buffer = getBoardBuffer();

        const dim = 100; // nb. fixed size
        canvas.width = canvas.height = dim + 2;
        canvas.style.width = canvas.style.height = `${dim * 5}px`;
        const data = new ImageData(canvas.width, canvas.height);

        for (let x = 1; x <= dim; ++x) {
          for (let y = 1; y <= dim; ++y) {
            const pos = y * (dim + 2) + x;
            const i = (pos / 8) << 0;
            const off = 1 << pos % 8;

            const alive = buffer[i] & off;
            if (!alive) {
              continue;
            }

            const doff = (y * canvas.width + x) * 4;
            data.data[doff + 0] = 255;
            data.data[doff + 3] = 255;
          }
        }

        canvas.getContext("2d").putImageData(data, 0, 0);
      }
    </script>
  </head>

  <body>
    <canvas id="canvas" style="image-rendering: pixelated; border: 2px solid blue;"></canvas>
  </body>
</html>
